# 面试练习模块实现文档

## 概述

本文档详细说明了面试练习模块的完整实现，包括交互流程设计、技术实现方案、AI提示词优化和界面关键元素。

## 一、交互流程设计

### 1. 开始面试
- 用户点击「开始」按钮后进入面试界面
- 系统自动生成首批5个面试问题
- 显示面试进度和计时器

### 2. 问题展示机制
- AI逐条显示面试问题（每次显示1题）
- 用户先看到问题并可自行思考答案
- 清晰的问题显示区域，支持滚动查看

### 3. 参考答案功能
- 点击「显示参考答案」后实时生成高质量示范答案
- 答案采用流式生成，前端实现打字机效果
- 参考答案会保存到本地状态，避免重复生成

### 4. 题目导航
- 用户完成当前题目后点击「下一题」继续
- 界面清晰显示当前进度（如：3/50）
- 支持返回上一题功能

## 二、技术实现方案

### 1. 问题生成策略
- 预生成50个问题，分10批（每批5个）异步生成
- 首批5个问题生成完成后立即开始面试
- 后续问题在面试过程中后台持续生成
- 采用缓存机制存储已生成问题

### 2. API调用逻辑
- **面试问题**：使用预生成问题（从缓存中读取）
- **参考答案**：实时调用API并流式返回结果

### 3. 异常处理
- 问题生成失败时自动重试机制
- 网络中断时保持当前进度并可恢复
- 优雅的错误提示和降级处理

## 三、AI提示词优化

### 面试问题生成提示词

```
角色：你是一名专业AI面试官「招才」，扮演资深HR专家。请基于以下背景信息生成高质量的面试问题。

面试背景：
1. 目标岗位：[用户选择的行业/岗位]
2. 候选人简历：[用户提供的简历文档解析后的文本]
3. 岗位描述：[用户提供的JD文本，如无可省略]

生成要求：
1. 首题固定：「你好！欢迎参加今天的面试。我是招才，今天将由我来主持你的面试。首先，请你简单地做个自我介绍吧。」
2. 问题类型配比（建议）：
   - 行为经验类（40%）：针对简历细节提问
   - 专业知识类（30%）：考察岗位硬技能
   - 情景假设类（30%）：设置典型工作场景
3. 问题总数：50个，保持自然对话流
```

### 参考答案生成提示词

```
你正在参加[用户选择的行业/岗位]的面试。请根据以下背景信息生成专业、自然的口语化回答。

面试背景：
1. 应聘岗位：[用户选择的行业/岗位]
2. 我的简历：[用户提供的简历文档解析后的文本]
3. 岗位要求：[用户提供的JD文本，如无可省略]

生成要求：
1. 回答需体现专业性且符合实际经验
2. 语言保持口语化，避免书面化表达
3. 重点突出与岗位的匹配度
4. 长度适中（约150-300字）
```

## 四、界面关键元素

### 1. 进度指示器
- 显示当前题数/总题数
- 线性进度条展示完成度
- 实时更新进度状态

### 2. 问题显示区域
- 清晰字体，易于阅读
- 支持长文本滚动
- 专业的卡片式设计

### 3. 参考答案按钮
- 防误触设计，避免重复点击
- 生成中显示加载状态
- 已生成答案的缓存显示

### 4. 流式答案展示区
- 打字机效果实现
- 平滑的字符逐个显示
- 支持长答案滚动查看

### 5. 下一题按钮
- 完成当前题后激活
- 支持上一题/下一题导航
- 面试完成后的结束按钮

### 6. 面试时间显示器
- 免费时间为30分钟
- 超过时间后需要付费才能使用
- 实时倒计时显示

## 五、文件结构

```
lib/
├── interview_state.dart          # 面试状态管理
├── mock_interview_screen.dart   # 主面试界面
├── services/
│   └── interview_service.dart   # 面试服务API调用
└── practice_chat_screen.dart    # 练习入口界面

server/
├── app.js                       # 服务器主文件
└── services/
    ├── deepseekService.js       # DeepSeek API服务
    └── promptBuilder.js         # 提示词构建器
```

## 六、核心功能实现

### 1. 状态管理 (interview_state.dart)
- `InterviewQuestion`: 单个面试问题模型
- `InterviewSession`: 面试会话状态管理
- `InterviewStateNotifier`: 状态变更通知器

### 2. 主界面 (mock_interview_screen.dart)
- 问题展示和导航
- 参考答案生成和显示
- 计时器和进度管理
- 支付提示对话框

### 3. API服务 (interview_service.dart)
- 问题生成API调用
- 参考答案流式生成
- 错误处理和重试机制

### 4. 服务器端 (app.js)
- `/api/interview/generate-questions`: 问题生成端点
- `/api/interview/generate-answer`: 参考答案流式生成端点
- 完整的错误处理和日志记录

## 七、使用说明

### 启动服务器
```bash
cd server
npm start
```

### 运行Flutter应用
```bash
flutter run
```

### 使用流程
1. 完成onboarding流程（选择岗位、上传简历）
2. 进入练习界面，点击「开始模拟面试」
3. 系统自动生成首批问题并开始面试
4. 逐题回答，可查看参考答案
5. 完成面试或时间到期

## 八、技术特点

- **流式生成**: 参考答案采用流式API，提供实时打字机效果
- **状态持久化**: 面试进度和答案缓存，支持中断恢复
- **智能提示词**: 基于用户简历和岗位要求定制化生成
- **优雅降级**: 网络异常时的友好提示和重试机制
- **响应式设计**: 适配不同屏幕尺寸的界面布局

## 九、未来扩展

- 支持更多问题类型和难度等级
- 添加语音识别和语音回答功能
- 实现面试结果分析和建议
- 支持多轮面试和不同面试官角色
- 添加面试记录和回放功能
